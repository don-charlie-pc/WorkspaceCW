/*! **********************************************************************************************
* 2014  ITESM Campus Guadalajara. Laboratorio de Microcontroladores 
*  
*
* @file:      StepperMotor.c
* @author(s):  
* Abner Perez Haro A01224776
* Juan Carlos Perez Castellanos A01225629
* 
* @brief (Theory of Operation)
*
**************************************************************************************************/

/*************************************************************************************************/
/*********************						Includes						**********************/
/*************************************************************************************************/
#include "GPIO.h"

/*************************************************************************************************/
/*********************						Defines							**********************/
/*************************************************************************************************/
#define BTN_PIN 1
#define M_PIN_A 0
#define M_PIN_B 1
#define M_PIN_C 2
#define M_PIN_D 3
/*************************************************************************************************/
/*********************						Typedefs						**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Function Prototypes					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Variables                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Global Variables					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Constants                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Global Constants                    **********************/
/*************************************************************************************************/
char gpu8stepValues[8] = {0x01,0x03,0x02,0x06,0x04,0x0C,0x08,0x09}; 
char gu8left = 1;
char gu8index = 0;

/*************************************************************************************************/
/*********************				   Exported Functions					**********************/
/*************************************************************************************************/

void StepperMotor_Init(void)
{
	//GPIO_ConfigPinDirection(PORTA,1,INPUT);
	
	//GPIO_ConfigPinDirection(PORTB,M_PIN_A,OUTPUT);
	//GPIO_ConfigPinDirection(PORTB,M_PIN_B,OUTPUT);
	//GPIO_ConfigPinDirection(PORTB,M_PIN_C,OUTPUT);
	//GPIO_ConfigPinDirection(PORTB,M_PIN_D,OUTPUT);
	
	GPIO_ConfigPortDirection(PORTB,OUTPUT);
	
	GPIO_WritePort(PORTB,gpu8stepValues[gu8index]);
}

void StepperMotor_NextStep(void)
{
	if(gu8left)
	{
		if(gu8index == 7)
		{
			gu8index = 0;
		}
		else
		{
			gu8index++;
		}
	}
	else
	{
		if(gu8index == 0)
		{
			gu8index = 7;
		}
		else
		{
			gu8index--;
		}
	}
	
	GPIO_WritePort(PORTB,gpu8stepValues[gu8index]);
}

void StepperMotor_RefreshDirection(void)
{
	if(GPIO_ReadPin(PORTA,BTN_PIN))
	{
		gu8left = (~gu8left)&0x01;
	}
}

/*************************************************************************************************/
/*********************				    Private Functions					**********************/
/*************************************************************************************************/
